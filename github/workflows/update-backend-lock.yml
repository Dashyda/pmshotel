# Workflow para actualizar backend/package-lock.json y commitearlo en la rama seleccionada
# Ejecuta manualmente desde Actions -> Update backend lockfile -> Run workflow
on:
  workflow_dispatch:
    inputs:
      target_branch:
        description: 'Branch donde commitear el package-lock (ej: fix/package-json-pg)'
        required: true
        default: 'fix/package-json-pg'

jobs:
  update-lock:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout target branch
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.inputs.target_branch }}
          persist-credentials: true
          fetch-depth: 0

      - name: Setup Node 18
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Update package-lock only in backend
        run: |
          cd backend
          npm install --package-lock-only
        env:
          CI: false

      - name: Commit and push updated lockfile
        uses: EndBug/add-and-commit@v9
        with:
          author_name: github-actions
          author_email: actions@github.com
          message: chore: update backend/package-lock.json to include pg
          add: backend/package-lock.json
          branch: ${{ github.event.inputs.target_branch }}
